<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GreaseBook Â· Sales Command Center</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
/* â”€â”€ RESET + BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
     background:#0d1117;color:#c9d1d9;min-height:100vh;padding:0}

/* â”€â”€ TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar{background:#161b22;border-bottom:1px solid #30363d;
        padding:14px 28px;display:flex;align-items:center;
        justify-content:space-between;position:sticky;top:0;z-index:100;height:52px}
.topbar-brand{display:flex;align-items:center;gap:12px}
.topbar-dot{width:8px;height:8px;border-radius:50%;background:#3fb950;
            box-shadow:0 0 6px #3fb95088;flex-shrink:0}
.topbar-title{font-size:1rem;font-weight:700;color:#fff}
.topbar-sub{font-size:.75rem;color:#8b949e;margin-top:1px}
.topbar-meta{font-size:.72rem;color:#484f58;text-align:right}
.topbar-meta span{color:#3fb950}

/* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.layout{display:flex;min-height:calc(100vh - 52px)}

/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar{width:220px;flex-shrink:0;background:#161b22;
         border-right:1px solid #30363d;position:sticky;
         top:52px;height:calc(100vh - 52px);overflow-y:auto}
.nav-group-label{font-size:.62rem;font-weight:700;text-transform:uppercase;
                 letter-spacing:.12em;color:#484f58;padding:16px 16px 6px}
.nav-group-label:first-child{padding-top:14px}
.nav-item{display:block;padding:9px 16px;font-size:.82rem;color:#8b949e;
          cursor:pointer;text-decoration:none;
          border-left:3px solid transparent;transition:all .15s}
.nav-item:hover{color:#c9d1d9;background:#1c2128}
.nav-item.active{color:#fff;background:#1c2128;
                 border-left-color:#3fb950;font-weight:600}

/* â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content{flex:1;padding:28px;overflow-x:hidden;min-width:0}

/* â”€â”€ PAGE SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page{display:none}
.page.active{display:block}

/* â”€â”€ PAGE HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-header{margin-bottom:22px}
.page-header h2{font-size:1.1rem;font-weight:700;color:#fff;margin-bottom:4px}
.page-header p{font-size:.78rem;color:#8b949e}

/* â”€â”€ WEEK LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.week-label{font-size:.8rem;color:#8b949e;margin-bottom:14px;
            display:flex;align-items:center;gap:8px}
.week-label strong{color:#c9d1d9}
.live-badge{background:#3fb95022;color:#3fb950;border:1px solid #3fb95044;
            border-radius:4px;font-size:.68rem;padding:2px 7px;font-weight:600}

/* â”€â”€ GOAL TRACKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.goal-row{display:flex;align-items:center;gap:16px;margin-bottom:20px;
          background:#161b22;border:1px solid #30363d;border-radius:10px;
          padding:14px 20px}
.goal-label{font-size:.7rem;font-weight:700;text-transform:uppercase;
            letter-spacing:.08em;color:#8b949e;white-space:nowrap;min-width:90px}
.goal-bar-wrap{flex:1;background:#21262d;border-radius:6px;height:8px;overflow:hidden}
.goal-bar-fill{height:8px;border-radius:6px;background:#388bfd;
               transition:width .5s ease;min-width:0}
.goal-bar-fill.goal-met{background:#3fb950}
.goal-text{font-size:.82rem;font-weight:700;color:#fff;white-space:nowrap}
.goal-pct{font-size:.72rem;color:#8b949e;margin-left:6px;white-space:nowrap}

/* â”€â”€ KPI CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:20px}
@media(max-width:900px){.kpi-row{grid-template-columns:repeat(2,1fr)}}
@media(max-width:500px){.kpi-row{grid-template-columns:1fr}}
.kpi-card{background:#161b22;border:1px solid #30363d;border-radius:10px;
          padding:20px 22px;position:relative;overflow:hidden}
.kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
                  background:var(--accent,#388bfd)}
.kpi-card.green::before{background:#3fb950}
.kpi-card.gold::before{background:#f0a500}
.kpi-card.red::before{background:#f85149}
.kpi-label{font-size:.68rem;font-weight:700;text-transform:uppercase;
           letter-spacing:.1em;color:#8b949e;margin-bottom:8px}
.kpi-value{font-size:2.2rem;font-weight:700;color:#fff;line-height:1;margin-bottom:4px}
.kpi-delta{font-size:.75rem;font-weight:600;margin-bottom:4px;min-height:16px}
.kpi-delta .up{color:#3fb950}
.kpi-delta .down{color:#f85149}
.kpi-delta .neutral{color:#8b949e}
.kpi-sub{font-size:.72rem;color:#8b949e;display:flex;align-items:center;gap:5px}

/* â”€â”€ RAG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rag{display:inline-block;width:7px;height:7px;border-radius:50%;
     flex-shrink:0;vertical-align:middle}
.rag-green{background:#3fb950;box-shadow:0 0 4px #3fb95066}
.rag-yellow{background:#f0a500;box-shadow:0 0 4px #f0a50066}
.rag-red{background:#f85149;box-shadow:0 0 4px #f8514966}
.val-good{color:#3fb950!important}
.val-warn{color:#f0a500!important}
.val-bad{color:#f85149!important}

/* â”€â”€ SKELETON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.skeleton{background:linear-gradient(90deg,#21262d 25%,#2d333b 50%,#21262d 75%);
          background-size:200% 100%;animation:shimmer 1.5s infinite;
          border-radius:4px;color:transparent!important;user-select:none}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* â”€â”€ SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section{background:#161b22;border:1px solid #30363d;border-radius:10px;
         padding:24px;margin-bottom:20px}
.section-title{font-size:.9rem;font-weight:600;color:#c9d1d9;
               margin-bottom:18px;display:flex;align-items:center;gap:8px}
.section-title .badge{background:#21262d;border:1px solid #30363d;
                      border-radius:4px;padding:1px 7px;font-size:.68rem;color:#8b949e}

/* â”€â”€ PERFORMANCE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.perf-table{width:100%;border-collapse:collapse;font-size:.82rem}
.perf-table th{text-align:right;padding:8px 12px;color:#484f58;
               border-bottom:2px solid #30363d;font-size:.68rem;
               text-transform:uppercase;letter-spacing:.06em;font-weight:600}
.perf-table th:first-child{text-align:left}
.perf-table td{padding:9px 12px;border-bottom:1px solid #21262d;
               vertical-align:middle;color:#c9d1d9;text-align:right}
.perf-table td:first-child{text-align:left;color:#8b949e;font-weight:500}
.perf-table tr:last-child td{border-bottom:none}
.perf-table tr:hover td{background:#1c2128}
.perf-table .totals-row td{color:#fff;font-weight:600}
.perf-table .totals-row td:first-child{color:#8b949e;font-weight:500}

/* â”€â”€ CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chart-wrap{position:relative;height:220px}

/* â”€â”€ FUNNEL CHAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.funnel-chain{display:flex;align-items:stretch;gap:0;overflow-x:auto;padding:4px 0 8px}
.funnel-stage{flex:1;min-width:96px;display:flex;flex-direction:column;
              align-items:center;padding:16px 8px;border-radius:8px}
.funnel-stage.live{background:#1c2128;border:1px solid #30363d}
.funnel-stage.soon{background:#0d1117;border:1px dashed #21262d;opacity:.55}
.funnel-stage-label{font-size:.62rem;font-weight:700;text-transform:uppercase;
                    letter-spacing:.07em;color:#484f58;margin-bottom:6px;
                    text-align:center;line-height:1.3}
.funnel-stage-val{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:3px}
.funnel-stage-val.soon-val{color:#484f58;font-size:1.1rem}
.funnel-connect{font-size:.6rem;color:#388bfd;text-align:center;margin-top:3px}
.funnel-arrow{display:flex;align-items:center;padding:0 4px;
              color:#30363d;font-size:.9rem;flex-shrink:0}
.funnel-conv{font-size:.68rem;font-weight:600;margin-top:4px}
.funnel-conv.live{color:#3fb950}
.funnel-conv.soon{color:#484f58}

/* â”€â”€ TWO-COL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
@media(max-width:800px){.two-col{grid-template-columns:1fr}}

/* â”€â”€ TABLE (generic) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
table{width:100%;border-collapse:collapse;font-size:.82rem}
th{text-align:left;padding:8px 10px;color:#484f58;border-bottom:1px solid #21262d;
   font-size:.68rem;text-transform:uppercase;letter-spacing:.06em;font-weight:500}
td{padding:9px 10px;border-bottom:1px solid #21262d;vertical-align:middle;color:#c9d1d9}
tr:last-child td{border-bottom:none}
tr:hover td{background:#1c2128}

/* â”€â”€ PLATFORM CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.platform-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}
@media(max-width:700px){.platform-grid{grid-template-columns:1fr}}
.platform-card{background:#0d1117;border:1px dashed #30363d;border-radius:10px;
               padding:20px;opacity:.65}
.platform-card-header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.platform-icon{font-size:1.2rem}
.platform-name{font-size:.88rem;font-weight:600;color:#8b949e}
.platform-metrics{display:flex;flex-direction:column;gap:7px}
.platform-metric{display:flex;justify-content:space-between;font-size:.8rem}
.platform-metric-label{color:#484f58}
.platform-metric-val{color:#484f58;font-weight:600}
.connect-label{font-size:.72rem;color:#388bfd66;margin-top:12px;
               display:flex;align-items:center;gap:4px}

/* â”€â”€ COMING SOON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.coming-soon-block{background:#0d1117;border:1px dashed #21262d;border-radius:8px;
                   padding:16px 20px;margin-top:4px;opacity:.7}
.coming-soon-title{font-size:.74rem;font-weight:600;color:#484f58;margin-bottom:10px}
.coming-soon-item{font-size:.78rem;color:#484f58;padding:5px 0;
                  border-bottom:1px solid #1c2128}
.coming-soon-item:last-of-type{border-bottom:none}
.coming-soon-connect{font-size:.72rem;color:#388bfd;margin-top:10px}

/* â”€â”€ REP TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rep-table{width:100%;border-collapse:collapse;font-size:.82rem}
.rep-table th{text-align:right;padding:8px 12px;color:#484f58;
              border-bottom:2px solid #30363d;font-size:.68rem;
              text-transform:uppercase;letter-spacing:.06em;font-weight:600}
.rep-table th:first-child{text-align:left}
.rep-table td{padding:8px 12px;border-bottom:1px solid #21262d;
              vertical-align:middle;color:#c9d1d9;text-align:right}
.rep-table td:first-child{text-align:left;color:#8b949e;font-weight:500}
.rep-table tr:last-child td{border-bottom:none}
.rep-table tr:hover td{background:#1c2128}
.rep-table .period-header td{background:#1c2128;color:#8b949e;font-size:.65rem;
                              text-transform:uppercase;letter-spacing:.08em;
                              font-weight:700;padding:5px 12px}
.rep-table .period-header td:first-child{color:#8b949e}

/* â”€â”€ VELOCITY BLOCKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.vel-grid{display:flex;gap:16px;margin-bottom:12px}
.vel-block{flex:1;background:#0d1117;border-radius:8px;padding:16px}
.vel-period{font-size:.65rem;text-transform:uppercase;letter-spacing:.1em;
            color:#484f58;margin-bottom:6px}
.vel-val{font-size:1.8rem;font-weight:700;color:#fff;line-height:1;margin-bottom:3px}
.vel-sub{font-size:.72rem;color:#8b949e}

/* â”€â”€ SOURCE MATRIX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#source-matrix-table th:not(:first-child){text-align:right}
#source-matrix-table td:not(:first-child){text-align:right}
#source-volume-table th:last-child{text-align:right}
#source-volume-table td:last-child{text-align:right}

/* â”€â”€ EMAIL TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.email-section th:not(:first-child){text-align:right}
.email-section td{color:#484f58}
.email-section td:first-child{text-align:left;color:#8b949e}
.email-section td:not(:first-child){text-align:right}

/* â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lb-row{display:flex;align-items:center;gap:12px;padding:10px 0;
        border-bottom:1px solid #21262d}
.lb-row:last-child{border-bottom:none}
.lb-rank{font-size:1.1rem;width:28px;flex-shrink:0}
.lb-name{flex:1;font-weight:600;color:#fff}
.lb-demos{font-size:.82rem;color:#8b949e}
.lb-bar-wrap{width:80px;flex-shrink:0}
.lb-bar{height:5px;border-radius:3px;min-width:2px}
.lb-rate{font-size:.82rem;color:#3fb950;font-weight:600;width:40px;
         text-align:right;flex-shrink:0}

/* â”€â”€ PIPELINE SPLIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.split-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.split-block{background:#0d1117;border-radius:8px;padding:16px}
.split-label{font-size:.65rem;text-transform:uppercase;letter-spacing:.1em;
             color:#484f58;margin-bottom:8px}
.split-items .item{display:flex;justify-content:space-between;
                   align-items:center;padding:5px 0;font-size:.82rem}
.split-items .item-label{color:#8b949e}
.split-items .item-val{font-weight:600;color:#c9d1d9}
.split-items .item-rate{color:#3fb950;font-size:.75rem;margin-left:6px}

/* â”€â”€ ERROR STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.error-state{background:#f851490d;border:1px solid #f8514944;border-radius:8px;
             padding:20px;margin-bottom:20px;color:#f85149;font-size:.85rem}
.error-state strong{display:block;margin-bottom:4px}

/* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer{text-align:center;color:#484f58;font-size:.72rem;padding:20px;
        border-top:1px solid #21262d;margin-top:8px}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-brand">
    <div class="topbar-dot"></div>
    <div>
      <div class="topbar-title">GreaseBook Â· Sales Command Center</div>
      <div class="topbar-sub">Live dashboard â€” auto-updates every 5 minutes</div>
    </div>
  </div>
  <div class="topbar-meta">
    Last updated: <span id="last-updated">Loading...</span>
  </div>
</div>

<!-- LAYOUT -->
<div class="layout">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="nav-group-label">Command Center</div>
    <a class="nav-item active" data-page="overview" onclick="switchPage('overview')">ğŸ  Overview</a>
    <div class="nav-group-label">Marketing</div>
    <a class="nav-item" data-page="marketing" onclick="switchPage('marketing')">ğŸ“£ Campaigns &amp; Ads</a>
    <a class="nav-item" data-page="leadflow" onclick="switchPage('leadflow')">ğŸ“¥ Lead Flow</a>
    <div class="nav-group-label">Sales</div>
    <a class="nav-item" data-page="bdr" onclick="switchPage('bdr')">ğŸ“ BDR Activity</a>
    <a class="nav-item" data-page="closer" onclick="switchPage('closer')">ğŸ¤ Closer</a>
  </nav>

  <!-- CONTENT -->
  <div class="content">

    <!-- ERROR BANNER -->
    <div class="error-state" id="error-banner" style="display:none">
      <strong>Could not load dashboard data</strong>
      Make sure the Dashboard Summary tab is published publicly in Google Sheets.
      <span id="error-detail"></span>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE: OVERVIEW
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-overview" class="page active">

      <!-- Week + Goal -->
      <div class="week-label">
        <strong id="week-range">Week: Loading...</strong>
        <span class="live-badge">LIVE</span>
      </div>
      <div class="goal-row">
        <span class="goal-label">Weekly Goal</span>
        <div class="goal-bar-wrap">
          <div class="goal-bar-fill" id="goal-bar" style="width:0%"></div>
        </div>
        <div style="display:flex;align-items:baseline;gap:0">
          <span class="goal-text" id="goal-text">-- / 20 demos</span>
          <span class="goal-pct" id="goal-pct"></span>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="kpi-row">
        <div class="kpi-card">
          <div class="kpi-label">Demos Booked</div>
          <div class="kpi-value skeleton" id="kpi-demos">--</div>
          <div class="kpi-delta" id="kpi-demos-delta">&nbsp;</div>
          <div class="kpi-sub">vs last week</div>
        </div>
        <div class="kpi-card green">
          <div class="kpi-label">Shows</div>
          <div class="kpi-value skeleton" id="kpi-shows">--</div>
          <div class="kpi-delta" id="kpi-shows-delta">&nbsp;</div>
          <div class="kpi-sub">Prospects who showed</div>
        </div>
        <div class="kpi-card gold">
          <div class="kpi-label">Show Rate</div>
          <div class="kpi-value skeleton" id="kpi-show-rate">--%</div>
          <div class="kpi-delta">&nbsp;</div>
          <div class="kpi-sub" id="kpi-show-rate-sub">4-wk avg: --</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Closes</div>
          <div class="kpi-value skeleton" id="kpi-closes">--</div>
          <div class="kpi-delta" id="kpi-closes-delta">&nbsp;</div>
          <div class="kpi-sub" id="kpi-closes-sub">Close rate: --</div>
        </div>
      </div>

      <!-- Performance Comparison Table -->
      <div class="section">
        <div class="section-title">
          Performance Comparison
          <span class="badge">Last week vs. rolling averages</span>
        </div>
        <table class="perf-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Last Week</th>
              <th>Avg / 4wk</th>
              <th>Avg / 90d</th>
              <th>Avg / Alltime</th>
            </tr>
          </thead>
          <tbody id="perf-table-body">
            <tr><td colspan="5" style="color:#484f58;text-align:center;padding:20px">Loading...</td></tr>
          </tbody>
        </table>
        <table class="perf-table" style="margin-top:16px">
          <thead>
            <tr>
              <th>Totals</th>
              <th>Last 4 Wks</th>
              <th>Last 90d</th>
              <th colspan="2">All Time</th>
            </tr>
          </thead>
          <tbody id="totals-table-body">
            <tr><td colspan="5" style="color:#484f58;text-align:center;padding:20px">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <!-- 8-Week Trend -->
      <div class="section">
        <div class="section-title">
          8-Week Trend
          <span class="badge">Demos booked vs. shows</span>
        </div>
        <div class="chart-wrap">
          <canvas id="trend-chart"></canvas>
        </div>
      </div>

      <!-- Funnel Chain -->
      <div class="section">
        <div class="section-title">
          Full Funnel
          <span class="badge">Marketing â†’ Demos â†’ Revenue</span>
        </div>
        <div class="funnel-chain" id="funnel-chain">
          <!-- Populated by JS -->
        </div>
      </div>

    </div><!-- /page-overview -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE: MARKETING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-marketing" class="page">
      <div class="page-header">
        <h2>ğŸ“£ Campaigns &amp; Ads</h2>
        <p>Paid ad performance + email outreach metrics. Connect ad APIs to unlock live data.</p>
      </div>

      <div class="platform-grid">
        <div class="platform-card">
          <div class="platform-card-header">
            <span class="platform-icon">ğŸ“˜</span>
            <span class="platform-name">Facebook Ads</span>
          </div>
          <div class="platform-metrics">
            <div class="platform-metric"><span class="platform-metric-label">Impressions</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Clicks</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CTR</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Spend</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPM</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPC</span><span class="platform-metric-val">--</span></div>
          </div>
          <div class="connect-label">ğŸ”Œ Connect Facebook Ads API</div>
        </div>
        <div class="platform-card">
          <div class="platform-card-header">
            <span class="platform-icon">ğŸ’¼</span>
            <span class="platform-name">LinkedIn Ads</span>
          </div>
          <div class="platform-metrics">
            <div class="platform-metric"><span class="platform-metric-label">Impressions</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Clicks</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CTR</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Spend</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPM</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPC</span><span class="platform-metric-val">--</span></div>
          </div>
          <div class="connect-label">ğŸ”Œ Connect LinkedIn Ads API</div>
        </div>
        <div class="platform-card">
          <div class="platform-card-header">
            <span class="platform-icon">ğŸ”</span>
            <span class="platform-name">Google Ads</span>
          </div>
          <div class="platform-metrics">
            <div class="platform-metric"><span class="platform-metric-label">Impressions</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Clicks</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CTR</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Spend</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPM</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPC</span><span class="platform-metric-val">--</span></div>
          </div>
          <div class="connect-label">ğŸ”Œ Connect Google Ads API</div>
        </div>
        <div class="platform-card">
          <div class="platform-card-header">
            <span class="platform-icon">ğŸ”·</span>
            <span class="platform-name">Bing Ads</span>
          </div>
          <div class="platform-metrics">
            <div class="platform-metric"><span class="platform-metric-label">Impressions</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Clicks</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CTR</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">Spend</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPM</span><span class="platform-metric-val">--</span></div>
            <div class="platform-metric"><span class="platform-metric-label">CPC</span><span class="platform-metric-val">--</span></div>
          </div>
          <div class="connect-label">ğŸ”Œ Connect Bing Ads API</div>
        </div>
      </div>

      <!-- Email: Instantly -->
      <div class="section">
        <div class="section-title">Email Outreach <span class="badge">Instantly</span></div>
        <div class="email-section">
          <table>
            <thead>
              <tr>
                <th>Metric</th>
                <th style="text-align:right">This Week</th>
                <th style="text-align:right">Last 4 Wks</th>
                <th style="text-align:right">Last 90d</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Emails Sent</td><td>--</td><td>--</td><td>--</td></tr>
              <tr><td>Open Rate</td><td>--</td><td>--</td><td>--</td></tr>
              <tr><td>Click Rate</td><td>--</td><td>--</td><td>--</td></tr>
              <tr><td>Link Clicks</td><td>--</td><td>--</td><td>--</td></tr>
            </tbody>
          </table>
        </div>
        <div class="coming-soon-connect" style="margin-top:14px">ğŸ”Œ Connect Instantly MCP to unlock email metrics</div>
      </div>
    </div><!-- /page-marketing -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE: LEAD FLOW
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-leadflow" class="page">
      <div class="page-header">
        <h2>ğŸ“¥ Lead Flow</h2>
        <p>Which sources generate booked meetings â€” and which ones actually show up?</p>
      </div>

      <!-- Source Ã— Show Rate Matrix -->
      <div class="section">
        <div class="section-title">
          Source Attribution
          <span class="badge">Last week â€” shows vs. no-shows by origin</span>
        </div>
        <table id="source-matrix-table">
          <thead>
            <tr>
              <th>Source</th>
              <th style="text-align:right">Demos</th>
              <th style="text-align:right">Shows</th>
              <th style="text-align:right">Show Rate</th>
              <th style="text-align:right">Quality Signal</th>
            </tr>
          </thead>
          <tbody id="source-matrix-body">
            <tr><td colspan="5" style="color:#484f58;text-align:center;padding:20px">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Rolling 4-Week Source Volume -->
      <div class="section">
        <div class="section-title">Rolling Source Volume <span class="badge">Last 4 weeks</span></div>
        <table id="source-volume-table">
          <thead>
            <tr>
              <th>Source</th>
              <th style="text-align:right">Demos (4wk)</th>
            </tr>
          </thead>
          <tbody id="source-volume-body">
            <tr><td colspan="2" style="color:#484f58;text-align:center;padding:20px">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Inbound Attribution â€” Coming Soon -->
      <div class="section">
        <div class="section-title">Inbound Attribution <span class="badge">Coming soon</span></div>
        <div class="coming-soon-block">
          <div class="coming-soon-title">What you'll see once connected:</div>
          <div class="coming-soon-item">ğŸ“Š Which ad drove each inbound booking</div>
          <div class="coming-soon-item">ğŸŒ Landing page visited before booking</div>
          <div class="coming-soon-item">ğŸ“ˆ UTM campaign â†’ demo â†’ show conversion</div>
          <div class="coming-soon-item">ğŸ’° Cost per demo by ad campaign</div>
          <div class="coming-soon-connect">ğŸ”Œ Connect GA4 UTM tracking to unlock</div>
        </div>
      </div>
    </div><!-- /page-leadflow -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE: BDR ACTIVITY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-bdr" class="page">
      <div class="page-header">
        <h2>ğŸ“ BDR Activity</h2>
        <p>Edgar + Leandro â€” outbound booking performance.</p>
      </div>

      <!-- Rep Performance Table -->
      <div class="section">
        <div class="section-title">
          Rep Performance
          <span class="badge">Last week + 4-week rolling</span>
        </div>
        <table class="rep-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th style="text-align:right">Edgar</th>
              <th style="text-align:right">Leandro</th>
              <th style="text-align:right">Total</th>
            </tr>
          </thead>
          <tbody id="rep-table-body">
            <tr><td colspan="4" style="color:#484f58;text-align:center;padding:20px">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Pipeline Velocity -->
      <div class="section">
        <div class="section-title">Pipeline Velocity <span class="badge">Days from booking to demo</span></div>
        <div class="vel-grid">
          <div class="vel-block">
            <div class="vel-period">Last Week</div>
            <div class="vel-val" id="vel-lw">--</div>
            <div class="vel-sub">avg days: booking â†’ demo</div>
          </div>
          <div class="vel-block">
            <div class="vel-period">4-Week Rolling</div>
            <div class="vel-val" id="vel-4wk">--</div>
            <div class="vel-sub">avg days: booking â†’ demo</div>
          </div>
        </div>
        <div style="font-size:.72rem;color:#484f58">
          Lower = better. Rising velocity = demos booked further out = pipeline health risk.
        </div>
      </div>

      <!-- Coming Soon: Kixie -->
      <div class="section">
        <div class="section-title">Call Activity <span class="badge">Coming soon</span></div>
        <div class="coming-soon-block">
          <div class="coming-soon-title">What you'll see once connected:</div>
          <div class="coming-soon-item">ğŸ“ Calls Made (per rep, per day)</div>
          <div class="coming-soon-item">ğŸ”— Connection Rate (answered / dialed)</div>
          <div class="coming-soon-item">â±ï¸ Avg Talk Time</div>
          <div class="coming-soon-item">ğŸ“… Dial-to-Demo Ratio</div>
          <div class="coming-soon-item">ğŸ¯ AI Coaching Score (from Rules Engine)</div>
          <div class="coming-soon-connect">ğŸ”Œ Connect Kixie API to unlock call metrics</div>
        </div>
      </div>
    </div><!-- /page-bdr -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE: CLOSER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-closer" class="page">
      <div class="page-header">
        <h2>ğŸ¤ Closer</h2>
        <p>Brandon â€” demo-to-close performance across all time periods.</p>
      </div>

      <!-- Closer Performance Table -->
      <div class="section">
        <div class="section-title">Closer Performance <span class="badge">Brandon â€” all periods</span></div>
        <table class="perf-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Last Week</th>
              <th>4-Wk Total</th>
              <th>90d Total</th>
              <th>All Time</th>
            </tr>
          </thead>
          <tbody id="closer-table-body">
            <tr><td colspan="5" style="color:#484f58;text-align:center;padding:20px">Loading...</td></tr>
          </tbody>
        </table>
        <div style="font-size:.72rem;color:#484f58;margin-top:10px" id="closer-avg-sub">
          Avg / week: -- closes (4wk) Â· -- (90d)
        </div>
      </div>

      <!-- Coming Soon: Revenue -->
      <div class="section">
        <div class="section-title">Revenue Data <span class="badge">Coming soon</span></div>
        <div class="coming-soon-block">
          <div class="coming-soon-title">What you'll see once connected:</div>
          <div class="coming-soon-item">ğŸ’° MRR Added This Week</div>
          <div class="coming-soon-item">ğŸ¯ Avg Deal Size</div>
          <div class="coming-soon-item">â±ï¸ Avg Days to Close</div>
          <div class="coming-soon-item">ğŸ“ˆ Revenue Run Rate (monthly / annual)</div>
          <div class="coming-soon-connect">ğŸ”Œ Connect FreshBooks or Pipedrive MCP to unlock</div>
        </div>
      </div>
    </div><!-- /page-closer -->

  </div><!-- /content -->
</div><!-- /layout -->

<!-- FOOTER -->
<div class="footer">
  GreaseBook Sales Command Center Â· Data from Google Sheets Â· Powered by Claude + Make.com
</div>

<script>
// â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GVIZ_URL = 'https://docs.google.com/spreadsheets/d/1RfGRwfRQlwPAenslF7X6yvBT1XLC-CHm85KfqNV9SK0/gviz/tq?tqx=out:json&sheet=Dashboard+Summary';
const REFRESH_MS = 5 * 60 * 1000;
const WEEKLY_DEMO_GOAL = 20; // Greg: update this number to change the goal bar target

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let trendChart = null;

// â”€â”€ PAGE SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const page = document.getElementById('page-' + id);
  if (page) page.classList.add('active');
  const nav = document.querySelector('[data-page="' + id + '"]');
  if (nav) nav.classList.add('active');
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pct(n) {
  if (n == null || isNaN(n)) return '--%';
  return Math.round(n * 100) + '%';
}
function num(n, dec) {
  if (n == null || isNaN(n)) return '--';
  if (dec != null) return n.toFixed(dec);
  return Math.round(n).toString();
}
function formatDate(dateVal) {
  if (!dateVal) return '--';
  if (typeof dateVal === 'string' && dateVal.startsWith('Date(')) {
    const parts = dateVal.slice(5,-1).split(',').map(Number);
    const d = new Date(Date.UTC(parts[0], parts[1], parts[2]));
    return d.toLocaleDateString('en-US', { month:'short', day:'numeric', timeZone:'UTC' });
  }
  if (typeof dateVal === 'string' && /^\d+\/\d+\/\d{4}$/.test(dateVal)) {
    const parts = dateVal.split('/');
    const d = new Date(Date.UTC(+parts[2], +parts[0]-1, +parts[1]));
    return d.toLocaleDateString('en-US', { month:'short', day:'numeric', timeZone:'UTC' });
  }
  if (typeof dateVal === 'number') {
    const d = new Date((dateVal - 25569) * 86400 * 1000);
    return d.toLocaleDateString('en-US', { month:'short', day:'numeric', timeZone:'UTC' });
  }
  return dateVal;
}
function removeSkeleton(id) {
  const el = document.getElementById(id);
  if (el) el.classList.remove('skeleton');
}
function ragDot(val, avg) {
  if (!avg) return '';
  if (val >= avg) return '<span class="rag rag-green"></span>';
  if (val >= avg * 0.9) return '<span class="rag rag-yellow"></span>';
  return '<span class="rag rag-red"></span>';
}
function ragClass(val, avg) {
  if (!avg) return '';
  if (val >= avg) return 'val-good';
  if (val >= avg * 0.9) return 'val-warn';
  return 'val-bad';
}
function deltaHtml(current, prev) {
  if (prev == null || isNaN(prev)) return '';
  const d = current - prev;
  if (d > 0) return '<span class="up">â–²+' + d + '</span> vs last week';
  if (d < 0) return '<span class="down">â–¼' + d + '</span> vs last week';
  return '<span class="neutral">â†’ same</span> vs last week';
}
function qualitySignal(showRate) {
  if (showRate == null || isNaN(showRate)) return 'â€” Unknown';
  if (showRate >= 0.75) return 'ğŸŸ¢ High';
  if (showRate >= 0.50) return 'ğŸŸ¡ Medium';
  return 'ğŸ”´ Low';
}

// â”€â”€ PARSE GVIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseGViz(text) {
  const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\)/);
  if (!match) throw new Error('GViz response format unexpected');
  return JSON.parse(match[1]);
}

// â”€â”€ BUILD KPI LOOKUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildKPILookup(rows) {
  const data = {};
  rows.forEach(r => {
    const label = r.c[0] && r.c[0].v;
    const value = r.c[1] && r.c[1].v;
    if (label && label !== 'label') data[label] = value;
  });
  return data;
}

// â”€â”€ BUILD TREND DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTrendData(rows) {
  const trendRows = [];
  rows.forEach(r => {
    const a = r.c[0] && r.c[0].v;
    const b = r.c[1] && r.c[1].v;
    if (typeof a === 'string' && /^\d+\/\d+\/\d{4}$/.test(a) && typeof b === 'number') {
      trendRows.push({ week: formatDate(a), demos: b || 0, shows: r.c[2] && r.c[2].v || 0 });
    }
  });
  return trendRows.reverse();
}

// â”€â”€ POPULATE: OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateOverview(d) {
  const demos     = d['demos_total']     || 0;
  const shows     = d['shows_total']     || 0;
  const showRate  = d['show_rate']       || 0;
  const closes    = d['closes']          || 0;
  const closeRate = d['close_rate']      || 0;
  const prev      = d['demos_prev_week'];

  // Week range
  document.getElementById('week-range').textContent =
    'Week: ' + formatDate(d['week_start']) + ' â€“ ' + formatDate(d['week_end']);

  // Goal tracker
  const goalPct = Math.min(demos / WEEKLY_DEMO_GOAL, 1);
  const bar = document.getElementById('goal-bar');
  bar.style.width = Math.round(goalPct * 100) + '%';
  if (goalPct >= 1) bar.classList.add('goal-met');
  document.getElementById('goal-text').textContent = demos + ' / ' + WEEKLY_DEMO_GOAL + ' demos';
  document.getElementById('goal-pct').textContent = ' â€” ' + Math.round(goalPct * 100) + '% to goal';

  // KPI values
  document.getElementById('kpi-demos').textContent     = num(demos);
  document.getElementById('kpi-shows').textContent     = num(shows);
  document.getElementById('kpi-show-rate').textContent = pct(showRate);
  document.getElementById('kpi-closes').textContent    = num(closes);

  // WoW deltas
  document.getElementById('kpi-demos-delta').innerHTML = deltaHtml(demos, prev) || '&nbsp;';

  // RAG on show rate
  const sr4wk = d['show_rate_4wk'] || 0;
  document.getElementById('kpi-show-rate-sub').innerHTML =
    ragDot(showRate, sr4wk) + ' 4-wk avg: ' + pct(sr4wk);
  document.getElementById('kpi-closes-sub').textContent = 'Close rate: ' + pct(closeRate);

  removeSkeleton('kpi-demos');
  removeSkeleton('kpi-shows');
  removeSkeleton('kpi-show-rate');
  removeSkeleton('kpi-closes');
}

// â”€â”€ POPULATE: PERFORMANCE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populatePerformanceTable(d) {
  const demos     = d['demos_total']  || 0;
  const shows     = d['shows_total']  || 0;
  const closes    = d['closes']       || 0;
  const showRate  = d['show_rate']    || 0;
  const closeRate = d['close_rate']   || 0;

  // 4-week
  const d4 = d['demos_4wk']   || 0;
  const s4 = d['shows_4wk']   || 0;
  const c4 = d['closes_4wk']  || 0;
  const avgD4  = d4 / 4;
  const avgS4  = s4 / 4;
  const avgC4  = c4 / 4;
  const sr4    = d4 > 0 ? s4 / d4 : 0;
  const cr4    = s4 > 0 ? c4 / s4 : 0;

  // 90-day
  const d90 = d['demos_90d']  || 0;
  const s90 = d['shows_90d']  || 0;
  const c90 = d['closes_90d'] || 0;
  const wk90   = 90 / 7;
  const avgD90 = d90 / wk90;
  const avgS90 = s90 / wk90;
  const avgC90 = c90 / wk90;
  const sr90   = d['show_rate_90d'] || 0;
  const cr90   = s90 > 0 ? c90 / s90 : 0;

  // All-time
  const dAll = d['alltime_demos']  || 0;
  const sAll = d['alltime_shows']  || 0;
  const cAll = d['closes_alltime'] || 0;
  const wkAll  = d['alltime_weeks'] || 1;
  const avgDAl = dAll / wkAll;
  const avgSAl = sAll / wkAll;
  const avgCAl = cAll / wkAll;
  const srAll  = dAll > 0 ? sAll / dAll : 0;
  const crAll  = sAll > 0 ? cAll / sAll : 0;

  const rows = [
    { label:'Demos Booked', lw:num(demos),      a4:num(avgD4,1),  a90:num(avgD90,1),  aAl:num(avgDAl,1), rVal:demos,     rAvg:avgD4 },
    { label:'Shows',        lw:num(shows),      a4:num(avgS4,1),  a90:num(avgS90,1),  aAl:num(avgSAl,1), rVal:shows,     rAvg:avgS4 },
    { label:'Show Rate',    lw:pct(showRate),   a4:pct(sr4),      a90:pct(sr90),      aAl:pct(srAll),    rVal:showRate,  rAvg:sr4   },
    { label:'Closes',       lw:num(closes),     a4:num(avgC4,1),  a90:num(avgC90,1),  aAl:num(avgCAl,1), rVal:closes,    rAvg:avgC4 },
    { label:'Close Rate',   lw:pct(closeRate),  a4:pct(cr4),      a90:pct(cr90),      aAl:pct(crAll),    rVal:closeRate, rAvg:cr4   },
  ];

  document.getElementById('perf-table-body').innerHTML = rows.map(r => {
    const cls = ragClass(r.rVal, r.rAvg);
    return `<tr>
      <td>${r.label}</td>
      <td class="${cls}">${r.lw} ${ragDot(r.rVal, r.rAvg)}</td>
      <td>${r.a4}</td>
      <td>${r.a90}</td>
      <td>${r.aAl}</td>
    </tr>`;
  }).join('');

  document.getElementById('totals-table-body').innerHTML = `
    <tr class="totals-row"><td>Demos</td><td>${num(d4)}</td><td>${num(d90)}</td><td colspan="2">${num(dAll)}</td></tr>
    <tr class="totals-row"><td>Shows</td><td>${num(s4)}</td><td>${num(s90)}</td><td colspan="2">${num(sAll)}</td></tr>
    <tr class="totals-row"><td>Closes</td><td>${num(c4)}</td><td>${num(c90)}</td><td colspan="2">${num(cAll)}</td></tr>
  `;
}

// â”€â”€ POPULATE: FUNNEL CHAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateFunnel(d) {
  const inbound   = d['inbound_demos'] || 0;
  const demos     = d['demos_total']   || 0;
  const shows     = d['shows_total']   || 0;
  const closes    = d['closes']        || 0;
  const showRate  = d['show_rate']     || 0;
  const closeRate = d['close_rate']    || 0;

  const stages = [
    { label:'Impressions',   val:'--',       conv:'',               live:false, connect:'Connect FB Ads' },
    { label:'Clicks',        val:'--',       conv:'',               live:false, connect:'Connect GA4'    },
    { label:'Web Traffic',   val:'--',       conv:'',               live:false, connect:'Connect GA4'    },
    { label:'Inbound Leads', val:inbound > 0 ? num(inbound) : '--', conv:'', live:inbound>0, connect:inbound===0?'No inbound this week':'' },
    { label:'Demos Booked',  val:num(demos), conv:'',               live:true,  connect:'' },
    { label:'Shows',         val:num(shows), conv:demos>0 ? pct(showRate) : '', live:true, connect:'' },
    { label:'Closes',        val:num(closes),conv:shows>0 ? pct(closeRate): '', live:true, connect:'' },
  ];

  document.getElementById('funnel-chain').innerHTML = stages.map((s, i) => {
    const arrow = i < stages.length - 1 ? '<div class="funnel-arrow">â€º</div>' : '';
    return `
      <div class="funnel-stage ${s.live ? 'live' : 'soon'}">
        <div class="funnel-stage-label">${s.label}</div>
        <div class="funnel-stage-val ${s.live ? '' : 'soon-val'}">${s.val}</div>
        ${s.conv ? `<div class="funnel-conv ${s.live ? 'live' : 'soon'}">${s.conv}</div>` : ''}
        ${s.connect && !s.live ? `<div class="funnel-connect">${s.connect}</div>` : ''}
      </div>
      ${arrow}`;
  }).join('');
}

// â”€â”€ POPULATE: LEAD FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateLeadFlow(d) {
  const inbD = d['inbound_demos'] || 0;
  const inbS = d['inbound_shows'] || 0;
  const coldD = d['cold_demos']   || 0;
  const coldS = d['cold_shows']   || 0;
  const total = d['demos_total']  || 0;
  const notTracked = Math.max(total - inbD - coldD, 0);

  const sources = [
    { name:'BDRs Outreach',  demos:coldD, shows:coldS },
    { name:'Inbound (all)',  demos:inbD,  shows:inbS  },
    { name:'Not Tracked',    demos:notTracked, shows:null },
  ];

  document.getElementById('source-matrix-body').innerHTML = sources.map(s => {
    const sr = s.shows != null && s.demos > 0 ? s.shows / s.demos : null;
    const srTxt = sr != null ? pct(sr) : '--';
    const q     = s.shows == null ? 'â€” Unknown' : qualitySignal(sr);
    return `<tr>
      <td>${s.name}</td>
      <td style="text-align:right">${num(s.demos)}</td>
      <td style="text-align:right">${s.shows != null ? num(s.shows) : '--'}</td>
      <td style="text-align:right">${srTxt}</td>
      <td style="text-align:right">${q}</td>
    </tr>`;
  }).join('');

  const inb4  = d['inbound_4wk'] || 0;
  const cold4 = d['cold_4wk']    || 0;
  document.getElementById('source-volume-body').innerHTML = `
    <tr><td>BDRs Outreach</td><td style="text-align:right">${num(cold4)}</td></tr>
    <tr><td>Inbound (all)</td><td style="text-align:right">${num(inb4)}</td></tr>
  `;
}

// â”€â”€ POPULATE: BDR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateBDR(d) {
  const eD  = d['edgar_demos']        || 0;
  const lD  = d['leandro_demos']      || 0;
  const eS  = d['edgar_shows']        || 0;
  const lS  = d['leandro_shows']      || 0;
  const tD  = eD + lD;
  const tS  = eS + lS;

  const e4  = d['edgar_4wk']          || 0;
  const l4  = d['leandro_4wk']        || 0;
  const eS4 = d['edgar_shows_4wk']    || 0;
  const lS4 = d['leandro_shows_4wk']  || 0;
  const t4  = e4 + l4;
  const tS4 = eS4 + lS4;

  const eRate  = eD > 0 ? pct(eS / eD)   : '--%';
  const lRate  = lD > 0 ? pct(lS / lD)   : '--%';
  const tRate  = tD > 0 ? pct(tS / tD)   : '--%';
  const eRate4 = e4 > 0 ? pct(eS4 / e4)  : '--%';
  const lRate4 = l4 > 0 ? pct(lS4 / l4)  : '--%';
  const tRate4 = t4 > 0 ? pct(tS4 / t4)  : '--%';

  const sr4wk = d['show_rate_4wk'] || 0;
  const ragSR = ragDot(tD > 0 ? tS/tD : 0, sr4wk);

  const velLw  = d['avg_velocity_lw'];
  const velAvg = d['avg_velocity_4wk'];

  document.getElementById('rep-table-body').innerHTML = `
    <tr class="period-header"><td colspan="4">LAST WEEK</td></tr>
    <tr><td>Demos Booked</td><td>${num(eD)}</td><td>${num(lD)}</td><td>${num(tD)}</td></tr>
    <tr><td>Shows</td><td>${num(eS)}</td><td>${num(lS)}</td><td>${num(tS)}</td></tr>
    <tr><td>Show Rate</td><td>${eRate}</td><td>${lRate}</td><td>${tRate} ${ragSR}</td></tr>
    <tr><td>Avg Booking Lead</td><td>--</td><td>--</td><td>${velLw ? num(velLw,1) + 'd' : '--'}</td></tr>
    <tr class="period-header"><td colspan="4">LAST 4 WEEKS</td></tr>
    <tr><td>Demos Booked</td><td>${num(e4)}</td><td>${num(l4)}</td><td>${num(t4)}</td></tr>
    <tr><td>Shows</td><td>${num(eS4)}</td><td>${num(lS4)}</td><td>${num(tS4)}</td></tr>
    <tr><td>Show Rate</td><td>${eRate4}</td><td>${lRate4}</td><td>${tRate4}</td></tr>
  `;

  const velLwEl  = document.getElementById('vel-lw');
  const velAvgEl = document.getElementById('vel-4wk');
  if (velLwEl)  velLwEl.textContent  = velLw  ? num(velLw, 1) + 'd'  : '--';
  if (velAvgEl) velAvgEl.textContent = velAvg ? num(velAvg, 1) + 'd' : '--';
}

// â”€â”€ POPULATE: CLOSER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateCloser(d) {
  const showsLW   = d['shows_total']   || 0;
  const closesLW  = d['closes']        || 0;
  const crLW      = d['close_rate']    || 0;

  const shows4    = d['shows_4wk']     || 0;
  const closes4   = d['closes_4wk']    || 0;
  const cr4       = shows4  > 0 ? closes4  / shows4  : 0;

  const shows90   = d['shows_90d']     || 0;
  const closes90  = d['closes_90d']    || 0;
  const cr90      = shows90 > 0 ? closes90 / shows90 : 0;

  const showsAll  = d['alltime_shows'] || 0;
  const closesAll = d['closes_alltime']|| 0;
  const crAll     = showsAll > 0 ? closesAll / showsAll : 0;

  document.getElementById('closer-table-body').innerHTML = `
    <tr><td>Demos Attended</td><td>${num(showsLW)}</td><td>${num(shows4)}</td><td>${num(shows90)}</td><td>${num(showsAll)}</td></tr>
    <tr><td>Closes</td><td>${num(closesLW)}</td><td>${num(closes4)}</td><td>${num(closes90)}</td><td>${num(closesAll)}</td></tr>
    <tr><td>Close Rate</td><td>${pct(crLW)}</td><td>${pct(cr4)}</td><td>${pct(cr90)}</td><td>${pct(crAll)}</td></tr>
  `;

  const avgC4  = closes4  / 4;
  const avgC90 = closes90 / (90 / 7);
  const sub = document.getElementById('closer-avg-sub');
  if (sub) sub.textContent = 'Avg / week: ' + num(avgC4, 1) + ' closes (4wk) Â· ' + num(avgC90, 1) + ' (90d)';
}

// â”€â”€ RENDER TREND CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTrend(rows) {
  const trend = buildTrendData(rows);
  if (trendChart) { trendChart.destroy(); trendChart = null; }
  const labels = trend.map(r => r.week);
  const demos  = trend.map(r => r.demos);
  const shows  = trend.map(r => r.shows);
  const ctx = document.getElementById('trend-chart').getContext('2d');
  trendChart = new Chart(ctx, {
    data: {
      labels,
      datasets: [
        {
          type: 'bar',
          label: 'Demos Booked',
          data: demos,
          backgroundColor: '#388bfd44',
          borderColor: '#388bfd',
          borderWidth: 1,
          borderRadius: 4,
          yAxisID: 'y',
        },
        {
          type: 'line',
          label: 'Shows',
          data: shows,
          borderColor: '#3fb950',
          backgroundColor: '#3fb95022',
          borderWidth: 2,
          pointRadius: 4,
          pointBackgroundColor: '#3fb950',
          tension: 0.3,
          fill: true,
          yAxisID: 'y',
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { labels: { color: '#8b949e', font: { size: 11 } } },
        tooltip: {
          backgroundColor: '#161b22',
          borderColor: '#30363d',
          borderWidth: 1,
          titleColor: '#c9d1d9',
          bodyColor: '#8b949e',
        },
      },
      scales: {
        x: { ticks: { color: '#484f58', font: { size: 11 } }, grid: { color: '#21262d' } },
        y: { ticks: { color: '#484f58', stepSize: 1 }, grid: { color: '#21262d' }, min: 0 },
      },
    },
  });
}

// â”€â”€ MAIN LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  try {
    document.getElementById('error-banner').style.display = 'none';
    const res = await fetch(GVIZ_URL + '&cachebust=' + Date.now());
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const text = await res.text();
    const gviz = parseGViz(text);
    const rows = gviz.table.rows;
    const kpi  = buildKPILookup(rows);

    populateOverview(kpi);
    populatePerformanceTable(kpi);
    populateFunnel(kpi);
    populateLeadFlow(kpi);
    populateBDR(kpi);
    populateCloser(kpi);
    renderTrend(rows);

    document.getElementById('last-updated').textContent =
      new Date().toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit' });

  } catch(err) {
    console.error('Dashboard load error:', err);
    document.getElementById('error-banner').style.display = 'block';
    document.getElementById('error-detail').textContent = ' Error: ' + err.message;
    document.getElementById('last-updated').textContent = 'Load failed';
  }
}

// â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadDashboard();
setInterval(loadDashboard, REFRESH_MS);
</script>
</body>
</html>
